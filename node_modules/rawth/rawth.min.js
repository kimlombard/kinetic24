!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e=e||self).rawth={})}(this,(function(e){"use strict";function r(e,r){void 0===r&&(r={});for(var t=function(e){for(var r=[],t=0;t<e.length;){var n=e[t];if("*"!==n&&"+"!==n&&"?"!==n)if("\\"!==n)if("{"!==n)if("}"!==n)if(":"!==n)if("("!==n)r.push({type:"CHAR",index:t,value:e[t++]});else{var i=1,o="";if("?"===e[a=t+1])throw new TypeError('Pattern cannot start with "?" at '+a);for(;a<e.length;)if("\\"!==e[a]){if(")"===e[a]){if(0===--i){a++;break}}else if("("===e[a]&&(i++,"?"!==e[a+1]))throw new TypeError("Capturing groups are not allowed at "+a);o+=e[a++]}else o+=e[a++]+e[a++];if(i)throw new TypeError("Unbalanced pattern at "+t);if(!o)throw new TypeError("Missing pattern at "+t);r.push({type:"PATTERN",index:t,value:o}),t=a}else{for(var f="",a=t+1;a<e.length;){var u=e.charCodeAt(a);if(!(u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||95===u))break;f+=e[a++]}if(!f)throw new TypeError("Missing parameter name at "+t);r.push({type:"NAME",index:t,value:f}),t=a}else r.push({type:"CLOSE",index:t,value:e[t++]});else r.push({type:"OPEN",index:t,value:e[t++]});else r.push({type:"ESCAPED_CHAR",index:t++,value:e[t++]});else r.push({type:"MODIFIER",index:t,value:e[t++]})}return r.push({type:"END",index:t,value:""}),r}(e),i=r.prefixes,o=void 0===i?"./":i,f="[^"+n(r.delimiter||"/#?")+"]+?",a=[],u=0,s=0,p="",c=function(e){if(s<t.length&&t[s].type===e)return t[s++].value},d=function(e){var r=c(e);if(void 0!==r)return r;var n=t[s],i=n.type,o=n.index;throw new TypeError("Unexpected "+i+" at "+o+", expected "+e)},l=function(){for(var e,r="";e=c("CHAR")||c("ESCAPED_CHAR");)r+=e;return r};s<t.length;){var v=c("CHAR"),h=c("NAME"),y=c("PATTERN");if(h||y){var m=v||"";-1===o.indexOf(m)&&(p+=m,m=""),p&&(a.push(p),p=""),a.push({name:h||u++,prefix:m,suffix:"",pattern:y||f,modifier:c("MODIFIER")||""})}else{var E=v||c("ESCAPED_CHAR");if(E)p+=E;else if(p&&(a.push(p),p=""),c("OPEN")){m=l();var x=c("NAME")||"",g=c("PATTERN")||"",w=l();d("CLOSE"),a.push({name:x||(g?u++:""),pattern:x&&!g?f:g,prefix:m,suffix:w,modifier:c("MODIFIER")||""})}else d("END")}}return a}function t(e,t){return function(e,r){void 0===r&&(r={});var t=i(r),n=r.encode,o=void 0===n?function(e){return e}:n,f=r.validate,a=void 0===f||f,u=e.map((function(e){if("object"==typeof e)return new RegExp("^(?:"+e.pattern+")$",t)}));return function(r){for(var t="",n=0;n<e.length;n++){var i=e[n];if("string"!=typeof i){var f=r?r[i.name]:void 0,s="?"===i.modifier||"*"===i.modifier,p="*"===i.modifier||"+"===i.modifier;if(Array.isArray(f)){if(!p)throw new TypeError('Expected "'+i.name+'" to not repeat, but got an array');if(0===f.length){if(s)continue;throw new TypeError('Expected "'+i.name+'" to not be empty')}for(var c=0;c<f.length;c++){var d=o(f[c],i);if(a&&!u[n].test(d))throw new TypeError('Expected all "'+i.name+'" to match "'+i.pattern+'", but got "'+d+'"');t+=i.prefix+d+i.suffix}}else if("string"!=typeof f&&"number"!=typeof f){if(!s){var l=p?"an array":"a string";throw new TypeError('Expected "'+i.name+'" to be '+l)}}else{d=o(String(f),i);if(a&&!u[n].test(d))throw new TypeError('Expected "'+i.name+'" to match "'+i.pattern+'", but got "'+d+'"');t+=i.prefix+d+i.suffix}}else t+=i}return t}}(r(e,t),t)}function n(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function i(e){return e&&e.sensitive?"":"i"}function o(e,t,o){return function(e,r,t){void 0===t&&(t={});for(var o=t.strict,f=void 0!==o&&o,a=t.start,u=void 0===a||a,s=t.end,p=void 0===s||s,c=t.encode,d=void 0===c?function(e){return e}:c,l="["+n(t.endsWith||"")+"]|$",v="["+n(t.delimiter||"/#?")+"]",h=u?"^":"",y=0,m=e;y<m.length;y++){var E=m[y];if("string"==typeof E)h+=n(d(E));else{var x=n(d(E.prefix)),g=n(d(E.suffix));if(E.pattern)if(r&&r.push(E),x||g)if("+"===E.modifier||"*"===E.modifier){var w="*"===E.modifier?"?":"";h+="(?:"+x+"((?:"+E.pattern+")(?:"+g+x+"(?:"+E.pattern+"))*)"+g+")"+w}else h+="(?:"+x+"("+E.pattern+")"+g+")"+E.modifier;else h+="("+E.pattern+")"+E.modifier;else h+="(?:"+x+g+")"+E.modifier}}if(p)f||(h+=v+"?"),h+=t.endsWith?"(?="+l+")":"$";else{var b=e[e.length-1],A="string"==typeof b?v.indexOf(b[b.length-1])>-1:void 0===b;f||(h+="(?:"+v+"(?="+l+"))?"),A||(h+="(?="+v+"|"+l+")")}return new RegExp(h,i(t))}(r(e,o),t,o)}function f(e,r,t){return e instanceof RegExp?function(e,r){if(!r)return e;var t=e.source.match(/\((?!\?)/g);if(t)for(var n=0;n<t.length;n++)r.push({name:n,prefix:"",suffix:"",modifier:"",pattern:""});return e}(e,r):Array.isArray(e)?function(e,r,t){var n=e.map((function(e){return f(e,r,t).source}));return new RegExp("(?:"+n.join("|")+")",i(t))}(e,r,t):o(e,r,t)}const a=Symbol();function u(...e){return new Promise((r,t)=>(function e(n,i){if(!n.length)return r(i);const[o,...f]=n,u="function"==typeof o?o(i):o,s=r=>e(f,r);if(null!=u){if(u===a)return;if(u.then)return u.then(s,t)}return Promise.resolve(s(u))})(e))}u.cancel=()=>a,u.compose=(...e)=>u(...e.reverse());const s=new Set,p=Symbol();function c(e,r){return e.forEach(t=>{t(r)===p&&e.delete(t)}),e}function d(e){throw new Error(e)}function l(...e){const[r,t,n,i]=[new Set,new Set,new Set,new Set(e)],o=function(e){const r=function*(){for(;;){const r=yield;yield u(r,...e)}}();return r.next(),r}(i),f=Object.create(o),a=e=>r=>e.add(r)&&f,s=e=>r=>e.delete(r)?f:d("Couldn't remove handler passed by reference");return Object.assign(f,{on:Object.freeze({value:a(r),error:a(t),end:a(n)}),off:Object.freeze({value:s(r),error:s(t),end:s(n)}),connect:a(i),push(e){const{value:n,done:i}=f.next(e);return i||n.then(e=>c(r,e),e=>c(t,e)),f},end:()=>(o.return(),c(n),[r,t,n,i].forEach(e=>e.clear()),f),fork:()=>l(...i),next(e){const r=o.next(e);return o.next(),r}})}l.install=function(e,r){return e&&"string"==typeof e||d("Please provide a name (as string) for your erre plugin"),r&&"function"==typeof r||d("Please provide a function for your erre plugin"),s.has(e)?d(`The ${e} is already part of the erre API, please provide a different name`):(l[e]=r,s.add(e)),l},l.install("cancel",u.cancel),l.install("off",()=>p);const v="undefined"!=typeof window,h=e=>e.replace(w.base,""),y=e=>r=>R(r,e)?r:l.cancel(),m=(e,r)=>(e.on.value(r.push),r.on.end(()=>{e.off.value(r.push)}),r),E=e=>{if(!w.silentErrors)throw new Error(e)},x=e=>(e=>"string"==typeof e)(e)?e:l.cancel(),g=l(x).on.error(E),w={base:"",silentErrors:!1,sensitive:!1,strict:!1,end:!0,start:!0,delimiter:"/#?",encode:void 0,endsWith:void 0,prefixes:"./"},b=e=>({...w,...e}),A=(e,r,t)=>{const{base:n}=b(t),[,...i]=r.exec(e),o=((...e)=>v?new URL(...e):require("url").parse(...e))(e,n);return o.params=i,o},R=(e,r)=>r.test(e),T=(e,r)=>[h,y(e),t=>A(t,e,r)];e.createURLStreamPipe=T,e.default=function(e,r){const t=f(e,[],r),n=l(...T(t,r));return m(g,n).on.error(E)},e.defaults=w,e.filterStrings=x,e.match=R,e.mergeOptions=b,e.router=g,e.toPath=(e,r,n)=>t(e,b(n))(r),e.toRegexp=(e,r,t)=>f(e,r,b(t)),e.toURL=A,Object.defineProperty(e,"__esModule",{value:!0})}));
